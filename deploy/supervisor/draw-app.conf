; Supervisor config for draw-app (Reverb + Queue worker or Horizon).
; Copy to /etc/supervisor/conf.d/ and run: supervisorctl reread && supervisorctl update
; Or use inside a container with supervisord as main process.
;
; Requires: APP base path set below (or use %(ENV_APP_PATH)s if set in environment).

[program:draw-app-reverb]
process_name=%(program_name)s
command=php /var/www/html/artisan reverb:start
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/reverb.log
stdout_logfile_maxbytes=10MB
stopwaitsecs=10

; Queue worker: use this when QUEUE_CONNECTION=database (no Redis).
[program:draw-app-queue]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue.log
stdout_logfile_maxbytes=10MB
stopwaitsecs=90

; Horizon: use this when QUEUE_CONNECTION=redis (comment out draw-app-queue above).
;[program:draw-app-horizon]
;process_name=%(program_name)s
;command=php /var/www/html/artisan horizon
;autostart=true
;autorestart=true
;stopasgroup=true
;killasgroup=true
;user=www-data
;redirect_stderr=true
;stdout_logfile=/var/www/html/storage/logs/horizon.log
;stdout_logfile_maxbytes=10MB
;stopwaitsecs=60
